#!/bin/bash
# Demo of Enhanced Debian-WS Functions
# Description: Demonstrates the new common functions adapted from archer
# Author: Generated by GitHub Copilot for Debian-WS

set -euo pipefail

# Source the enhanced libraries
source "$(dirname "$0")/../lib/core/logging.sh"
source "$(dirname "$0")/../lib/core/common.sh"

echo "ðŸŽ‰ Debian-WS Enhanced Functions Demo"
echo "===================================="
echo

# Test system detection
log_info "Testing system detection functions..."

if check_debian_system; then
    log_success "âœ“ Debian system detected"
else
    log_error "âœ— Not a Debian system"
fi

if check_gnome_desktop; then
    log_success "âœ“ GNOME desktop detected"
else
    log_warning "âš  GNOME desktop not detected"
fi

if check_sudo_privileges; then
    log_success "âœ“ Sudo privileges available"
else
    log_error "âœ— No sudo privileges"
fi

if check_internet; then
    log_success "âœ“ Internet connection available"
else
    log_warning "âš  No internet connection"
fi

echo
echo "ðŸ“Š System Information:"
echo "  Architecture: $(get_system_arch)"
echo "  Gum available: $(command_exists gum && echo "Yes" || echo "No")"
echo

# Test UI functions (if gum is available)
if command_exists gum; then
    log_info "Testing enhanced UI functions..."

    if confirm_action "Would you like to test the selection functions?" true; then
        log_info "Great! Let's test some selections..."

        # Test single selection
        test_options=("Option A" "Option B" "Option C" "Skip this test")
        log_info "Single selection test:"
        choice=$(select_option "${test_options[@]}")
        log_success "You selected: $choice"

        if [[ "$choice" != "Skip this test" ]]; then
            # Test input
            log_info "Input test:"
            user_input=$(get_input "Enter your name" "Anonymous User" "Test User")
            log_success "Hello, $user_input!"
        fi
    else
        log_info "Skipping UI tests"
    fi
else
    log_warning "Gum not available - UI functions will use fallback mode"
    log_info "Install gum to see enhanced UI: sudo apt install gum"
fi

echo
log_info "Testing utility functions..."

# Test directory creation
test_dir="/tmp/debian-ws-test-$$"
if create_directory "$test_dir"; then
    log_success "âœ“ Directory created: $test_dir"

    # Test file backup (create a test file first)
    echo "test content" > "$test_dir/test.txt"
    backup_path=$(backup_file "$test_dir/test.txt")
    if [[ $? -eq 0 ]]; then
        log_success "âœ“ File backup created: $backup_path"
    fi

    # Cleanup
    rm -rf "$test_dir"
    log_debug "Cleaned up test directory"
else
    log_error "âœ— Failed to create test directory"
fi

echo
show_completion "Demo Complete" "All enhanced functions from archer have been successfully adapted for Debian-WS!\n\nKey improvements:\nâ€¢ Gum-based interactive UI with fallbacks\nâ€¢ Robust retry logic for installations\nâ€¢ Comprehensive system detection\nâ€¢ Enhanced error handling and logging"

echo
log_info "Try running the main installer to see these functions in action:"
log_info "  ./bin/debian-ws.sh"
